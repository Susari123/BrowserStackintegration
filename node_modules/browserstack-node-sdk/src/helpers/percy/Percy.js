const a109_0x174f4b=a109_0x496c;(function(_0x3dd602,_0x30cb51){const _0x1c6dc6=a109_0x496c,_0xeaabb=_0x3dd602();while(!![]){try{const _0x4bea0e=-parseInt(_0x1c6dc6(0x10a))/0x1+-parseInt(_0x1c6dc6(0x125))/0x2+-parseInt(_0x1c6dc6(0x122))/0x3+parseInt(_0x1c6dc6(0x10c))/0x4*(-parseInt(_0x1c6dc6(0x126))/0x5)+-parseInt(_0x1c6dc6(0x138))/0x6*(parseInt(_0x1c6dc6(0x110))/0x7)+-parseInt(_0x1c6dc6(0x133))/0x8+parseInt(_0x1c6dc6(0x13e))/0x9;if(_0x4bea0e===_0x30cb51)break;else _0xeaabb['push'](_0xeaabb['shift']());}catch(_0x45bee5){_0xeaabb['push'](_0xeaabb['shift']());}}}(a109_0x56d1,0x8c2bd));const fs=require('fs'),path=require('path'),os=require('os'),{spawn}=require(a109_0x174f4b(0x13f)),helper=require(a109_0x174f4b(0x142)),logger=require(a109_0x174f4b(0x12e))[a109_0x174f4b(0x144)],{getLogDir}=require(a109_0x174f4b(0x12e)),testHubConstants=require('../../helpers/testhub/constants'),PerformanceTester=require('../../helpers/performance/performance-tester'),{PERCY_EVENTS:PerformanceEvents}=require(a109_0x174f4b(0x127)),PercyBinary=require(a109_0x174f4b(0x150));function a109_0x496c(_0x48adec,_0x2c7626){const _0x56d160=a109_0x56d1();return a109_0x496c=function(_0x496cdc,_0x2dc046){_0x496cdc=_0x496cdc-0x104;let _0x35932a=_0x56d160[_0x496cdc];return _0x35932a;},a109_0x496c(_0x48adec,_0x2c7626);}class Percy{#logfile=path[a109_0x174f4b(0x107)](getLogDir(),a109_0x174f4b(0x121));#address=process[a109_0x174f4b(0x14d)]['PERCY_SERVER_ADDRESS']||a109_0x174f4b(0x13d);#binaryPath=null;#config=null;#proc=null;#logStream=null;#isApp=![];[a109_0x174f4b(0x11f)]=![];constructor(_0x4ec854){this.#config=_0x4ec854,!!_0x4ec854['app']&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x5ae7b4=a109_0x174f4b;if(!this.#binaryPath){const _0x1886f5=new PercyBinary();PerformanceTester[_0x5ae7b4(0x118)](PerformanceEvents[_0x5ae7b4(0x11b)]),this.#binaryPath=await _0x1886f5[_0x5ae7b4(0x123)](this.#config),PerformanceTester[_0x5ae7b4(0x11d)](PerformanceEvents[_0x5ae7b4(0x11b)]);}return this.#binaryPath;}async #sleep(_0x18eb9d){return new Promise(_0x499ab5=>setTimeout(_0x499ab5,_0x18eb9d));}async[a109_0x174f4b(0x12f)](){const _0xb9553a=a109_0x174f4b,_0x515f51={};_0x515f51['nnBBk']=_0xb9553a(0x14a),_0x515f51[_0xb9553a(0x149)]=_0xb9553a(0x124);const _0x16ab93=_0x515f51;try{const _0x2b28fa=await helper[_0xb9553a(0x145)](_0x16ab93['nnBBk'],_0x16ab93[_0xb9553a(0x149)],null,null,this.#address);if(_0x2b28fa)return!![];}catch(_0x4cd875){return![];}}async[a109_0x174f4b(0x118)](){const _0x54c584=a109_0x174f4b,_0x45b219={'UEuNn':_0x54c584(0x113),'jguEq':'exec','PjUnW':function(_0x3859d1,_0x382286,_0x185d3b,_0x1d6617){return _0x3859d1(_0x382286,_0x185d3b,_0x1d6617);},'yDTUd':_0x54c584(0x140),'RGSWq':_0x54c584(0x105)},_0x254dfa=await this.#getBinaryPath(),_0x2b331d={};_0x2b331d[_0x54c584(0x139)]='a',this.#logStream=fs[_0x54c584(0x11c)](this.#logfile,_0x2b331d);const _0x1ae4d3=await this['fetchPercyToken'](),_0x5b9b27=await this[_0x54c584(0x12d)]();if(!_0x1ae4d3)return![];const _0x26863a=[(this.#isApp?_0x45b219[_0x54c584(0x11e)]:_0x45b219['jguEq'])+_0x54c584(0x12a)];_0x5b9b27&&_0x26863a[_0x54c584(0x109)]('-c',_0x5b9b27);this.#proc=_0x45b219['PjUnW'](spawn,_0x254dfa,_0x26863a,{'env':Object['assign'](process[_0x54c584(0x14d)],{'PERCY_TOKEN':_0x1ae4d3,'TH_BUILD_UUID':process[_0x54c584(0x14d)][testHubConstants['ENV_VAR'][_0x54c584(0x12c)]]})}),this.#proc[_0x54c584(0x10b)]['pipe'](this.#logStream),this.#proc['stderr'][_0x54c584(0x148)](this.#logStream),this[_0x54c584(0x11f)]=!![];var _0x34e768=this;this.#proc['on'](_0x45b219[_0x54c584(0x13b)],function(_0x14279f){_0x34e768['isProcessRunning']=![];});do{const _0x58ac3c=await this[_0x54c584(0x12f)]();if(_0x58ac3c)return logger[_0x54c584(0x136)](_0x45b219[_0x54c584(0x146)]),!![];await this.#sleep(0x3e8);}while(this[_0x54c584(0x11f)]);return![];}async[a109_0x174f4b(0x10e)](){const _0xa3d78e=a109_0x174f4b,_0x405b87={'QuaJo':function(_0x543960,_0x118b8c){return _0x543960(_0x118b8c);},'xCPAG':function(_0x283a98,_0x10ef9b,_0x6b477d){return _0x283a98(_0x10ef9b,_0x6b477d);},'BuoXk':_0xa3d78e(0x13c),'YMixX':_0xa3d78e(0x140)},_0x276932=await this.#getBinaryPath();return new Promise((_0xa3939a,_0x83ac75)=>{const _0x8ad40b=_0xa3d78e,_0x35f64a=_0x405b87[_0x8ad40b(0x112)](spawn,_0x276932,[_0x405b87['BuoXk']]);_0x35f64a['on'](_0x405b87[_0x8ad40b(0x13a)],_0xe9058f=>{const _0x16831b=_0x8ad40b;this[_0x16831b(0x11f)]=![],this.#logStream&&(this.#logStream['end'](),this.#logStream=null),_0x405b87['QuaJo'](_0xa3939a,_0xe9058f);});});}['isRunning'](){return this['isProcessRunning'];}async[a109_0x174f4b(0x135)](){const _0x389deb=a109_0x174f4b,_0x2fe464={};_0x2fe464['kbmaM']=_0x389deb(0x116),_0x2fe464[_0x389deb(0x147)]=_0x389deb(0x108),_0x2fe464[_0x389deb(0x104)]=_0x389deb(0x14a),_0x2fe464[_0x389deb(0x12b)]=_0x389deb(0x14c);const _0x14bfc=_0x2fe464,_0x965d0=this.#config['projectName'];try{const _0x10f0fc=this.#isApp?_0x14bfc[_0x389deb(0x10d)]:_0x14bfc[_0x389deb(0x147)],_0x4fd41f=await helper[_0x389deb(0x145)](_0x14bfc[_0x389deb(0x104)],'api/app_percy/get_project_token?name='+_0x965d0+_0x389deb(0x130)+_0x10f0fc,{},this.#config),_0x2f2f24=_0x4fd41f[_0x389deb(0x11a)];return logger[_0x389deb(0x136)](_0x14bfc[_0x389deb(0x12b)]),_0x2f2f24[_0x389deb(0x10f)];}catch(_0x5c50c8){return logger[_0x389deb(0x111)](_0x389deb(0x14b)+_0x5c50c8),null;}}async['createPercyConfig'](){const _0x558db2=a109_0x174f4b,_0x5d482c={'TxrDB':function(_0x432caf,_0x443e15){return _0x432caf(_0x443e15);},'lqOha':function(_0x14b123,_0x5c6ae0){return _0x14b123+_0x5c6ae0;},'sDkSh':_0x558db2(0x114),'tsjbn':function(_0xab690d,_0x526791){return _0xab690d(_0x526791);},'TGExP':_0x558db2(0x119)};if(!this.#config[_0x558db2(0x131)])return null;const _0x53d9b2=path[_0x558db2(0x107)](os['tmpdir'](),_0x5d482c[_0x558db2(0x120)]),_0x3f0237=this.#config['percyOptions'];return!_0x3f0237[_0x558db2(0x117)]&&(_0x3f0237[_0x558db2(0x117)]='2'),new Promise((_0x35de85,_0x21a358)=>{const _0x22d700=_0x558db2,_0x1b2939={'HZYEk':function(_0x4474bd,_0x3fb94b){const _0x5030e0=a109_0x496c;return _0x5d482c[_0x5030e0(0x137)](_0x4474bd,_0x3fb94b);},'MCoug':function(_0x239375,_0x1b093b){const _0x103d09=a109_0x496c;return _0x5d482c[_0x103d09(0x106)](_0x239375,_0x1b093b);},'wJYKK':_0x5d482c[_0x22d700(0x134)],'WEdHo':function(_0x4729e7,_0x5793f8){const _0x5c3d26=_0x22d700;return _0x5d482c[_0x5c3d26(0x141)](_0x4729e7,_0x5793f8);}};fs[_0x22d700(0x14e)](_0x53d9b2,JSON[_0x22d700(0x115)](_0x3f0237),_0x187da0=>{const _0x127f51=_0x22d700;_0x187da0&&(logger[_0x127f51(0x111)](_0x127f51(0x128)+_0x187da0),_0x1b2939[_0x127f51(0x14f)](_0x35de85,null)),logger['debug'](_0x1b2939[_0x127f51(0x143)](_0x1b2939[_0x127f51(0x132)],_0x53d9b2)),_0x1b2939['WEdHo'](_0x35de85,_0x53d9b2);});});}}module[a109_0x174f4b(0x129)]=Percy;function a109_0x56d1(){const _0x2fcba6=['exec:stop','http://localhost:5338','46287144AzURor','child_process','close','tsjbn','../helper','MCoug','winstonLogger','nodeRequest','RGSWq','FIXeW','pipe','ayOFc','GET','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','Percy\x20fetch\x20token\x20success','env','writeFile','HZYEk','./PercyBinary','DKioH','Percy\x20healthcheck\x20successful','lqOha','join','automate','push','861307VHTJpF','stdout','4FOcmVt','kbmaM','stop','token','77IEwmJO','error','xCPAG','app:exec','Percy\x20config\x20created\x20at\x20','stringify','app','version','start','percy.json','data','DOWNLOAD','createWriteStream','end','UEuNn','isProcessRunning','TGExP','percy.log','135105xbiGHe','getBinaryPath','percy/healthcheck','2215724NrqaoG','5157535pUNFYY','../../helpers/performance/constants','Error\x20creating\x20percy\x20config:\x20','exports',':start','Yphjx','BROWSERSTACK_TESTHUB_UUID','createPercyConfig','../logger','healthcheck','&type=','percyOptions','wJYKK','7577368TJkmXW','sDkSh','fetchPercyToken','debug','TxrDB','314178BdOVKS','flags','YMixX','yDTUd'];a109_0x56d1=function(){return _0x2fcba6;};return a109_0x56d1();}